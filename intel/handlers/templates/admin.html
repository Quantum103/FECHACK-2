<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Административная панель - Управление дипломными работами</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <!-- Анимированный фон -->
    <div class="background-animation">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        <div class="floating-shape shape-4"></div>
    </div>

    <!-- Контейнер приложения -->
    <div class="app-container">
        <!-- Боковая панель -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">Дипломные работы</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="fas fa-home nav-icon"></i>
                        <span>Главная</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/students" class="nav-link" data-page="students">
                        <i class="fas fa-users nav-icon"></i>
                        <span>Студенты</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="topics">
                        <i class="fas fa-book nav-icon"></i>
                        <span>Темы работ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/ruc/" class="nav-link" data-page="supervisors">
                        <i class="fas fa-chalkboard-teacher nav-icon"></i>
                        <span>Руководители</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="assignments">
                        <i class="fas fa-tasks nav-icon"></i>
                        <span>Назначения</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="export">
                        <i class="fas fa-file-export nav-icon"></i>
                        <span>Выгрузка</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Основной контент -->
        <div class="main-content">
            <div class="header">
                <h1 class="page-title" id="pageTitle">Панель администратора</h1>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">АД</div>
                </div>
            </div>

            <!-- Контент будет подгружаться динамически -->
            <div id="contentArea">
                <!-- Стартовая страница -->
                <div class="page-content" id="dashboardPage">
                    <!-- Карточки статистики -->
                    <div class="stats-container" id="statsContainer">
                        <div class="stat-card">
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-label">Всего студентов</div>
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalTopics">0</div>
                            <div class="stat-label">Тем работ</div>
                            <div class="stat-icon"><i class="fas fa-book"></i></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalSupervisors">0</div>
                            <div class="stat-label">Руководителей</div>
                            <div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="assignedCount">0</div>
                            <div class="stat-label">Назначено тем</div>
                            <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                        </div>
                    </div>

                    <!-- Панель управления -->
                    <div class="control-panel">
                        <h2 class="panel-title"><i class="fas fa-file-upload"></i> Загрузка данных</h2>
                        
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-file-excel"></i>
                            <div class="upload-text">Загрузите файл Excel</div>
                            <div class="upload-hint">Перетащите файл сюда или нажмите для выбора</div>
                            <input type="file" class="file-input" id="fileInput" accept=".xlsx, .xls">
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="uploadStudentsBtn" data-type="students">
                                <i class="fas fa-upload"></i> Загрузить студентов
                            </button>
                            <button class="btn btn-primary" id="uploadTopicsBtn" data-type="topics">
                                <i class="fas fa-upload"></i> Загрузить темы
                            </button>
                            <button class="btn btn-primary" id="uploadSupervisorsBtn" data-type="supervisors">
                                <i class="fas fa-upload"></i> Загрузить руководителей
                            </button>
                            <button class="btn btn-secondary" id="downloadTemplateBtn">
                                <i class="fas fa-download"></i> Скачать шаблон
                            </button>
                        </div>
                        
                        <!-- Блок для отображения статуса загрузки -->
                        <div id="uploadStatus" style="display: none; margin-top: 15px; padding: 10px; border-radius: 5px;"></div>
                    </div>

                    <!-- Таблица последних действий -->
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Последние действия</h2>
                        </div>
                        <table id="recentActivityTable">
                            <thead>
                                <tr>
                                    <th>Дата</th>
                                    <th>Действие</th>
                                    <th>Пользователь</th>
                                    <th>Статус</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" style="text-align: center; color: #999;">
                                        Нет данных для отображения
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Остальные страницы остаются без изменений -->
                <!-- Страница студентов -->
                <div class="page-content" id="studentsPage" style="display: none;">
                    <div class="page-header">
                        <h2>Управление студентами</h2>
                        <button class="btn btn-primary" id="addStudentBtn">
                            <i class="fas fa-plus"></i> Добавить студента
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="studentSearch" placeholder="Поиск студентов...">
                            </div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="exportStudentsBtn">
                                    <i class="fas fa-file-export"></i> Экспорт
                                </button>
                            </div>
                        </div>
                        <table id="studentsTable">
                            <thead>
                                <tr>
                                    <th>ФИО</th>
                                    <th>Группа</th>
                                    <th>Тема</th>
                                    <th>Руководитель</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="6" style="text-align: center; color: #999;">
                                        Нет данных для отображения
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Страница тем -->
                <div class="page-content" id="topicsPage" style="display: none;">
                    <!-- ... аналогично ... -->
                </div>

                <!-- Страница выгрузки -->
                <div class="page-content" id="exportPage" style="display: none;">
                    <!-- ... аналогично ... -->
                </div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Редактирование</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Содержимое будет генерироваться динамически -->
            </div>
            <div class="modal-footer" style="padding: 20px; border-top: 1px solid #eee; text-align: right;">
                <button class="btn btn-secondary" id="cancelBtn">Отмена</button>
                <button class="btn btn-primary" id="saveBtn">Сохранить</button>
            </div>
        </div>
    </div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded');
    

    // Загрузка файла
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    let selectedFile = null;
    
    if (uploadArea && fileInput) {
        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                selectedFile = this.files[0];
                const fileName = selectedFile.name;
                uploadArea.innerHTML = `
                    <i class="fas fa-check-circle" style="color: #4CAF50;"></i>
                    <div class="upload-text">Файл "${fileName}" выбран</div>
                    <div class="upload-hint">Нажмите кнопку загрузки ниже</div>
                `;
                uploadArea.style.borderColor = '#4CAF50';
                uploadArea.style.background = 'rgba(76, 175, 80, 0.05)';
            }
        });
    }
    
    // Обработчики для кнопок загрузки
    document.addEventListener('click', function(e) {
        if (e.target.id === 'uploadStudentsBtn' || e.target.closest('#uploadStudentsBtn')) {
            handleFileUpload('students');
        }
        else if (e.target.id === 'uploadTopicsBtn' || e.target.closest('#uploadTopicsBtn')) {
            handleFileUpload('topics');
        }
        else if (e.target.id === 'uploadSupervisorsBtn' || e.target.closest('#uploadSupervisorsBtn')) {
            handleFileUpload('supervisors');
        }
        else if (e.target.id === 'downloadTemplateBtn' || e.target.closest('#downloadTemplateBtn')) {
            downloadTemplate();
        }
    });
    
    async function handleFileUpload(type) {
        if (!selectedFile) {
            alert('Пожалуйста, выберите файл для загрузки');
            return;
        }
        
        const button = document.getElementById(`upload${type.charAt(0).toUpperCase() + type.slice(1)}Btn`);
        const originalHTML = button.innerHTML;
        
        try {
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Загрузка...';
            button.disabled = true;
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('type', type);
            
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.json();
            
            if (result.success) {
                button.innerHTML = '<i class="fas fa-check"></i> Успешно!';
                button.style.background = '#4CAF50';
                alert(result.message);
                
                // Сбрасываем форму
                selectedFile = null;
                fileInput.value = '';
                resetUploadArea();
            } else {
                throw new Error(result.error);
            }
            
        } catch (error) {
            console.error('Upload failed:', error);
            button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ошибка';
            button.style.background = '#f44336';
            alert(`Ошибка: ${error.message}`);
        } finally {
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;
                button.style.background = '';
            }, 3000);
        }
    }
    
    function resetUploadArea() {
        const uploadArea = document.getElementById('uploadArea');
        if (uploadArea) {
            uploadArea.innerHTML = `
                <i class="fas fa-file-excel"></i>
                <div class="upload-text">Загрузите файл Excel</div>
                <div class="upload-hint">Перетащите файл сюда или нажмите для выбора</div>
            `;
            uploadArea.style.borderColor = 'rgba(213, 195, 169, 0.3)';
            uploadArea.style.background = 'transparent';
        }
    }
    
    function downloadTemplate() {
        // Спросим пользователя, какой шаблон он хочет скачать
        const templateType = prompt('Какой шаблон скачать?\nВведите "1" для шаблона студентов\nВведите "2" для шаблона тем');
        
        let filename, url;
        
        if (templateType === '1') {
            filename = 'template_students.xlsx';
            url = '/static/templates/template_students.xlsx';
        } else if (templateType === '2') {
            filename = 'template_topics.xlsx';
            url = '/static/templates/template_topics.xlsx';
        } else {
            alert('Неверный выбор');
            return;
        }
        
        // Создаем временную ссылку для скачивания
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    // Модальное окно
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    
    if (closeModal) {
        closeModal.addEventListener('click', function() {
            document.getElementById('editModal').style.display = 'none';
        });
    }
    
    if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
            document.getElementById('editModal').style.display = 'none';
        });
    }
});
</script>

</body>
</html>